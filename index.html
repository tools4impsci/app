<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project: A Future Without [Your Problem]</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@2.6.0/src/wordcloud2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Lora:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A single-page application with a fixed top navigation bar (Overview, Phases, Case Study, Rubric, Resources) to allow non-linear exploration of the project details. This structure is chosen over a simple document to make the information more accessible and engaging for master's students. Key interactions include tabbed navigation for the project phases and interactive Chart.js recreations of W.E.B. Du Bois' data portraits, which serve as a core teaching element. This design prioritizes clarity and focused learning by chunking information into distinct, easily accessible sections. -->
    <!-- Visualization & Content Choices: Report Info: Project Phases -> Goal: Organize -> Viz/Presentation: Tabbed Interface -> Interaction: Click to reveal phase details -> Justification: Breaks down a multi-step project into manageable chunks, reducing cognitive load. Report Info: W.E.B. Du Bois Data Portraits -> Goal: Inspire/Analyze -> Viz/Presentation: Recreated charts (Doughnut, Bar) -> Interaction: Hover for tooltips -> Justification: Actively demonstrates the power of data visualization for social change, a key theme, making the case study more impactful than static images. Library: Chart.js (Canvas). Report Info: Rubric -> Goal: Inform -> Viz/Presentation: HTML Table -> Interaction: None -> Justification: Provides clear, structured grading criteria in a universally understood format. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #3C3C3B;
        }
        h1, h2, h3, h4 {
            font-family: 'Lora', serif;
        }
        .nav-link {
            transition: color 0.3s ease, border-bottom-color 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .nav-link.active {
            color: #C57B57;
            border-bottom-color: #C57B57;
        }
        .nav-link:hover {
            color: #C57B57;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .tab-button {
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .tab-button.active {
            background-color: #C57B57;
            color: #FDFBF8;
        }
        .chart-container { 
            position: relative; 
            width: 100%; 
            max-width: 500px; 
            margin-left: auto; 
            margin-right: auto; 
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) { 
            .chart-container { 
                height: 400px;
                max-height: 500px;
            } 
        }
        .draggable {
            cursor: move;
        }
        .drop-zone {
            transition: background-color 0.2s ease;
        }
        .drop-zone.drag-over {
            background-color: #c57b5720;
            border-style: dashed;
        }
        .timeline {
            position: relative;
            padding-left: 3rem;
        }
        .timeline:before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #e5e7eb;
        }
        .timeline-item {
            position: relative;
        }
        .timeline-item:before {
            content: '';
            position: absolute;
            left: -33px;
            top: 4px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: #C57B57;
            border: 2px solid white;
        }
        .value-item.disabled {
            display: none;
        }
        .d3-tooltip { position: absolute; text-align: left; padding: 8px; font: 12px sans-serif; background: rgba(0,0,0,0.8); color: white; border: 0px; border-radius: 8px; pointer-events: none; max-width: 200px; word-wrap: break-word; }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-10 border-b border-gray-200">
        <nav id="main-nav" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="font-bold text-lg text-[#3C3C3B]">Futures Project</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#" data-target="overview" class="nav-link active px-3 py-2 text-sm font-medium">Overview</a>
                        <a href="#" data-target="phases" class="nav-link px-3 py-2 text-sm font-medium">Project Phases</a>
                        <a href="#" data-target="case-study" class="nav-link px-3 py-2 text-sm font-medium">Case Study</a>
                        <a href="#" data-target="rubric" class="nav-link px-3 py-2 text-sm font-medium">Deliverables & Rubric</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <select id="mobile-nav" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                        <option value="overview">Overview</option>
                        <option value="phases">Project Phases</option>
                        <option value="case-study">Case Study</option>
                        <option value="rubric">Deliverables & Rubric</option>
                    </select>
                </div>
            </div>
        </nav>
    </header>

    <main class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <section id="overview" class="content-section active">
            <div class="bg-white rounded-lg shadow-sm p-8 relative">
                <button id="reset-data-btn" class="absolute top-6 right-6 flex items-center px-3 py-2 text-sm text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    Delete Project
                </button>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Project: A Future Without...</h1>
                <p class="text-lg text-[#C57B57] mb-6">Using Futures Thinking to Model Social Change</p>
                <div class="space-y-4 text-gray-700 leading-relaxed">
                    <p><strong>Course:</strong> Practicing Design Thinking for Social Change</p>
                    <p><strong>Weight:</strong> 10% of Final Grade</p>
                    <h2 class="text-2xl font-semibold text-gray-800 pt-4">Project Purpose</h2>
                    <p>This project invites you to engage deeply with a complex social problem by envisioning a future where it has been successfully addressed. You will use futures thinking methodologies to create a tangible "artifact" or model of this preferred future. This process moves beyond problem analysis to the constructive work of imagining and articulating a desirable outcome, providing a North Star for present-day action.</p>
                    <h2 class="text-2xl font-semibold text-gray-800 pt-4">Learning Objectives</h2>
                    <ul class="list-disc list-outside ml-5 space-y-2">
                        <li>Apply futures thinking and backcasting techniques to a real-world social issue.</li>
                        <li>Develop a rich, multi-faceted vision of a preferred future state.</li>
                        <li>Synthesize research and imagination to create a compelling model or artifact.</li>
                        <li>Communicate a future vision in a way that inspires understanding and action.</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="phases" class="content-section">
            <div class="bg-white rounded-lg shadow-sm p-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Project Phases & Activities</h1>
                <div id="tabs-container" class="flex border-b border-gray-200">
                    <button data-tab="phase1" class="tab-button active flex-1 py-2 px-4 text-center font-medium rounded-t-lg">Phase 1: Vision</button>
                    <button data-tab="phase2" class="tab-button flex-1 py-2 px-4 text-center font-medium rounded-t-lg">Phase 2: Backcasting</button>
                    <button data-tab="phase3" class="tab-button flex-1 py-2 px-4 text-center font-medium rounded-t-lg">Phase 3: Creation</button>
                </div>
                <div class="mt-6">
                    <div id="phase1" class="tab-content">
                        <div class="space-y-4">
                            <div class="accordion-item border rounded-lg">
                                <button class="accordion-header w-full flex justify-between items-center text-left p-4 bg-stone-50 hover:bg-stone-100 focus:outline-none rounded-t-lg"><h3 class="font-semibold text-lg text-gray-800">Activity 1.1: Define Problem Space</h3><span class="accordion-icon text-2xl font-thin text-gray-500 transform transition-transform">+</span></button>
                                <div class="accordion-content hidden p-6 border-t">
                                    <div class="space-y-4">
                                        <div><label for="problem-statement" class="block text-sm font-medium text-gray-700">Problem Statement</label><textarea data-save="problemStatement" id="problem-statement" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., Lack of access to fresh, affordable food in urban food deserts."></textarea></div>
                                        <div><label for="root-causes" class="block text-sm font-medium text-gray-700">Root Causes</label><textarea data-save="rootCauses" id="root-causes" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., Systemic redlining, lack of grocery store investment, transportation gaps..."></textarea></div>
                                        <div><label for="affected-communities" class="block text-sm font-medium text-gray-700">Affected Individuals & Groups</label><textarea data-save="affectedCommunities" id="affected-communities" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., Low-income families, elderly residents, children..."></textarea></div>
                                    </div>
                                </div>
                            </div>
                             <div class="accordion-item border rounded-lg">
                                <button class="accordion-header w-full flex justify-between items-center text-left p-4 bg-stone-50 hover:bg-stone-100 focus:outline-none rounded-t-lg"><h3 class="font-semibold text-lg text-gray-800">Activity 1.2: Construct Future Vision</h3><span class="accordion-icon text-2xl font-thin text-gray-500 transform transition-transform">+</span></button>
                                <div class="accordion-content hidden p-6 border-t">
                                    <div class="grid md:grid-cols-2 gap-4"><textarea data-save="visionSee" id="vision-see" class="vision-input w-full rounded-md border-gray-300 shadow-sm" rows="3" placeholder="What do you SEE?"></textarea><textarea data-save="visionHear" id="vision-hear" class="vision-input w-full rounded-md border-gray-300 shadow-sm" rows="3" placeholder="What do you HEAR?"></textarea><textarea data-save="visionFeel" id="vision-feel" class="vision-input w-full rounded-md border-gray-300 shadow-sm" rows="3" placeholder="How do people FEEL?"></textarea><textarea data-save="visionExist" id="vision-exist" class="vision-input w-full rounded-md border-gray-300 shadow-sm" rows="3" placeholder="What new systems EXIST?"></textarea></div>
                                    <button id="synthesize-vision-btn" class="mt-4 px-4 py-2 bg-[#C57B57] text-white font-semibold rounded-lg shadow-md">Synthesize & Visualize</button>
                                    <div id="synthesized-vision-output" class="mt-4 p-4 bg-emerald-50 text-emerald-800 rounded-lg hidden"></div>
                                    <canvas id="vision-wordcloud" class="mt-4 rounded-lg"></canvas>
                                </div>
                            </div>
                            <div class="accordion-item border rounded-lg">
                                <button class="accordion-header w-full flex justify-between items-center text-left p-4 bg-stone-50 hover:bg-stone-100 focus:outline-none rounded-t-lg"><h3 class="font-semibold text-lg text-gray-800">Activity 1.3: Anchor in Values</h3><span class="accordion-icon text-2xl font-thin text-gray-500 transform transition-transform">+</span></button>
                                <div class="accordion-content hidden p-6 border-t">
                                    <p class="mb-4 text-gray-600">Search for values, select them to add to your ranked list, then drag to reorder.</p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="border rounded-lg p-4">
                                            <h4 class="font-semibold mb-2 text-center">Available Values</h4>
                                            <input type="search" id="value-search" placeholder="Search values..." class="w-full p-2 border rounded-md mb-2">
                                            <ul id="values-pool" class="space-y-2 h-64 overflow-y-auto pr-2"></ul>
                                        </div>
                                        <div class="border rounded-lg p-4">
                                            <h4 class="font-semibold mb-2 text-center">Your Ranked Values</h4>
                                            <ul id="ranked-values" class="drop-zone border-2 rounded-lg min-h-[288px] p-2 space-y-2"></ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="phase2" class="tab-content" style="display: none;">
                        <div class="space-y-4">
                            <div class="accordion-item border rounded-lg">
                                <button class="accordion-header w-full flex justify-between items-center text-left p-4 bg-stone-50 hover:bg-stone-100 focus:outline-none rounded-t-lg"><h3 class="font-semibold text-lg text-gray-800">Activity 2.1: Map Milestones</h3><span class="accordion-icon text-2xl font-thin text-gray-500 transform transition-transform">+</span></button>
                                <div class="accordion-content hidden p-6 border-t">
                                    <div class="flex flex-col sm:flex-row gap-4 p-4 border rounded-lg bg-gray-50 mb-6"><div class="flex-1"><label for="milestone-year" class="block text-sm font-medium text-gray-700">Year</label><input type="number" id="milestone-year" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., 2045"></div><div class="flex-auto"><label for="milestone-desc" class="block text-sm font-medium text-gray-700">Milestone</label><input type="text" id="milestone-desc" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., 'National Urban Agriculture Act passed'"></div><div class="self-end"><button id="add-milestone-btn" class="w-full sm:w-auto px-4 py-2 bg-[#C57B57] text-white font-semibold rounded-lg shadow-md">Add</button></div></div>
                                    <div id="timeline-output">
                                        <h4 class="font-semibold text-lg text-gray-700 mb-4">Your Backcasting Timeline</h4>
                                        <div id="milestone-list" class="timeline space-y-6"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item border rounded-lg">
                                <button class="accordion-header w-full flex justify-between items-center text-left p-4 bg-stone-50 hover:bg-stone-100 focus:outline-none rounded-t-lg"><h3 class="font-semibold text-lg text-gray-800">Activity 2.2: Analyze Enablers & Barriers</h3><span class="accordion-icon text-2xl font-thin text-gray-500 transform transition-transform">+</span></button>
                                <div class="accordion-content hidden p-6 border-t">
                                    <p class="mb-4 text-gray-600">For each milestone, map the forces that could help (enablers) or hinder (barriers) its achievement. This adds realism to your pathway.</p>
                                    <div class="space-y-4">
                                        <div>
                                            <label for="critical-milestone" class="block text-sm font-medium text-gray-700">Select a Milestone to Analyze</label>
                                            <select id="critical-milestone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></select>
                                        </div>
                                        <div id="enabler-barrier-tool-container" class="mt-6"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="phase3" class="tab-content" style="display: none;">
                        <div class="space-y-4">
                            <div class="accordion-item border rounded-lg">
                                <button class="accordion-header w-full flex justify-between items-center text-left p-4 bg-stone-50 hover:bg-stone-100 focus:outline-none rounded-t-lg"><h3 class="font-semibold text-lg text-gray-800">Activity 3.1: Brainstorm Artifact</h3><span class="accordion-icon text-2xl font-thin text-gray-500 transform transition-transform">+</span></button>
                                <div class="accordion-content hidden p-6 border-t">
                                     <fieldset class="mb-4"><div class="flex flex-wrap gap-4" id="artifact-radios"></div></fieldset>
                                     <div id="artifact-concept-container"></div>
                                </div>
                            </div>
                            <div class="accordion-item border rounded-lg">
                                <button class="accordion-header w-full flex justify-between items-center text-left p-4 bg-stone-50 hover:bg-stone-100 focus:outline-none rounded-t-lg"><h3 class="font-semibold text-lg text-gray-800">Activity 3.2: Define Your Audience</h3><span class="accordion-icon text-2xl font-thin text-gray-500 transform transition-transform">+</span></button>
                                <div class="accordion-content hidden p-6 border-t">
                                    <p class="mb-4 text-gray-600">Who are you trying to reach with your artifact? Create a simple persona.</p>
                                    <div class="grid sm:grid-cols-2 gap-4">
                                        <input data-save="personaName" type="text" class="block w-full rounded-md border-gray-300 shadow-sm" placeholder="Persona Name (e.g., Councilwoman Evans)">
                                        <input data-save="personaRole" type="text" class="block w-full rounded-md border-gray-300 shadow-sm" placeholder="Role (e.g., City Policy Maker)">
                                        <textarea data-save="personaGoals" rows="2" class="sm:col-span-2 block w-full rounded-md border-gray-300 shadow-sm" placeholder="What are their goals? (e.g., Wants to see innovative, evidence-based solutions for her district.)"></textarea>
                                        <textarea data-save="personaConcerns" rows="2" class="sm:col-span-2 block w-full rounded-md border-gray-300 shadow-sm" placeholder="What are their concerns? (e.g., Budget constraints, public opinion, implementation complexity.)"></textarea>
                                    </div>
                                </div>
                            </div>
                             <div class="accordion-item border rounded-lg">
                                <button class="accordion-header w-full flex justify-between items-center text-left p-4 bg-stone-50 hover:bg-stone-100 focus:outline-none rounded-t-lg"><h3 class="font-semibold text-lg text-gray-800">Activity 3.3: Plan Your Artifact Canvas</h3><span class="accordion-icon text-2xl font-thin text-gray-500 transform transition-transform">+</span></button>
                                <div class="accordion-content hidden p-6 border-t">
                                    <p class="mb-4 text-gray-600">Use this canvas to solidify the core message and purpose of your artifact.</p>
                                     <div class="grid md:grid-cols-3 gap-4">
                                        <div class="border-l-4 border-blue-400 pl-3"><label class="block text-sm font-medium text-gray-700">Key Message</label><textarea data-save="canvasMessage" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="What is the single most important idea you want your audience to take away?"></textarea></div>
                                        <div class="border-l-4 border-green-400 pl-3"><label class="block text-sm font-medium text-gray-700">Target Audience</label><textarea data-save="canvasAudience" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Who are you communicating to? Be specific."></textarea></div>
                                        <div class="border-l-4 border-purple-400 pl-3"><label class="block text-sm font-medium text-gray-700">Desired Impact</label><textarea data-save="canvasImpact" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="What do you want your audience to think, feel, or do after experiencing your artifact?"></textarea></div>
                                     </div>
                                </div>
                            </div>
                            <div class="accordion-item border rounded-lg">
                                <button class="accordion-header w-full flex justify-between items-center text-left p-4 bg-stone-50 hover:bg-stone-100 focus:outline-none rounded-t-lg"><h3 class="font-semibold text-lg text-gray-800">Activity 3.4: Outline Presentation</h3><span class="accordion-icon text-2xl font-thin text-gray-500 transform transition-transform">+</span></button>
                                <div class="accordion-content hidden p-6 border-t">
                                     <div class="space-y-4">
                                        <div><label class="block text-sm font-medium text-gray-700">1. Hook</label><textarea data-save="presoHook" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="How will you grab the audience's attention?"></textarea></div>
                                        <div><label class="block text-sm font-medium text-gray-700">2. The Future Vision</label><textarea data-save="presoVision" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Paint a vivid picture of the world you've imagined."></textarea></div>
                                        <div><label class="block text-sm font-medium text-gray-700">3. The Artifact Demo</label><textarea data-save="presoDemo" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="How will you present your artifact and explain it?"></textarea></div>
                                        <div><label class="block text-sm font-medium text-gray-700">4. The Path Forward</label><textarea data-save="presoPath" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Briefly share 1-2 key milestones. How does this begin?"></textarea></div>
                                     </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="case-study" class="content-section">
            <div class="bg-white rounded-lg shadow-sm p-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Case Study: W.E.B. Du Bois' Data Portraits</h1>
                <p class="text-lg text-gray-600 mb-6">Visualizing a Present to Argue for a Better Future</p>
                <p class="text-gray-700 leading-relaxed mb-8">
                    In 1900, sociologist and activist W.E.B. Du Bois led the creation of "The Exhibit of American Negroes" at the Exposition Universelle in Paris. Instead of just presenting dry statistics, his team created a series of stunningly modern data visualizations to depict the condition, progress, and challenges of Black Americans just one generation after emancipation. These "data portraits" were an act of futures thinking. By documenting the present reality of Black life—their professions, property ownership, and literacy—Du Bois was implicitly arguing against the racist narratives of the time and envisioning a future of equality and full citizenship. He used data not just to describe, but to persuade and project a possible trajectory.
                </p>
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div class="text-center md:text-left">
                        <h3 class="text-2xl font-semibold text-gray-800 mb-3">The Georgia Negro: A Social Study</h3>
                        <p class="text-gray-700 leading-relaxed mb-4">This spiral visualization shows the assessed value of taxable property owned by Black Georgians. Rather than a simple bar chart, the spiral form creates a dynamic sense of progress and accumulation over time. It's a powerful visual metaphor for a community building wealth against incredible odds, projecting a future of continued economic advancement.</p>
                        <p class="text-sm text-gray-500">Hover over the chart segments to see the data. This is a recreation based on the original's form and data.</p>
                    </div>
                    <div class="chart-container">
                        <canvas id="duboisSpiralChart"></canvas>
                    </div>
                </div>
                <hr class="my-12">
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div class="text-center md:text-left md:order-2">
                        <h3 class="text-2xl font-semibold text-gray-800 mb-3">Occupations of Black and White Georgians</h3>
                        <p class="text-gray-700 leading-relaxed mb-4">This chart directly compares the occupational distribution between Black and White populations in Georgia. By placing the bars side-by-side, Du Bois starkly illustrates the economic segregation of the time, with the Black population overwhelmingly concentrated in agriculture and domestic service. This visualization served as a clear, data-driven indictment of the limited opportunities available, implying that a just future requires a radical restructuring of the economic landscape.</p>
                        <p class="text-sm text-gray-500">This is a recreation based on the original's data, illustrating the comparative power of his work.</p>
                    </div>
                     <div class="chart-container md:order-1">
                        <canvas id="duboisBarChart"></canvas>
                    </div>
                </div>
                 <div class="mt-12 bg-stone-100 p-6 rounded-lg">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">Connecting to Our Project</h3>
                    <p class="text-gray-700 leading-relaxed">Du Bois' work is a prime example of using data artifacts to practice design thinking for social change. He diagnosed a problem (racism, inequality) and then created artifacts that not only defined that problem but also modeled a different reality—one of progress, capability, and humanity. His work is a form of backcasting: by presenting the data of "what is," he created a baseline from which a better future could be imagined and fought for. Your project challenges you to do the same: create an artifact that makes your preferred future feel tangible, plausible, and worth striving for.</p>
                </div>
            </div>
        </section>

        <section id="rubric" class="content-section">
             <div class="bg-white rounded-lg shadow-sm p-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Deliverables & Grading Rubric</h1>
                <h2 class="text-2xl font-semibold text-gray-800 mb-3">Final Deliverables</h2>
                <ul class="list-disc list-outside ml-5 space-y-2 text-gray-700 mb-8">
                    <li><strong>Future Artifact/Model:</strong> The tangible representation of your future vision.</li>
                    <li><strong>Presentation:</strong> A 5-7 minute presentation to the class.</li>
                    <li><strong>Process Summary:</strong> A brief (1-2 page) written document outlining your process.</li>
                </ul>
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Evaluation Rubric</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-stone-50"><tr><th class="p-3">Criteria</th><th class="p-3">Exemplary (9-10)</th><th class="p-3">Proficient (7-8)</th><th class="p-3">Developing (5-6)</th></tr></thead>
                        <tbody>
                            <tr class="border-b"><td class="p-3 font-medium">Clarity & Depth of Future Vision</td><td class="p-3">The vision is highly detailed, holistic, and compelling.</td><td class="p-3">The vision is clear and well-considered.</td><td class="p-3">The vision is present but lacks detail.</td></tr>
                            <tr class="border-b"><td class="p-3 font-medium">Backcasting & Plausibility</td><td class="p-3">The backcasted pathway is logical, well-researched, and plausible.</td><td class="p-3">The pathway is mostly logical with clear milestones.</td><td class="p-3">The pathway is unclear or key milestones are missing.</td></tr>
                            <tr class="border-b"><td class="p-3 font-medium">Creativity & Impact of Model</td><td class="p-3">The artifact is highly creative and powerfully communicates the vision.</td><td class="p-3">The artifact effectively communicates the vision.</td><td class="p-3">The artifact does not clearly communicate the vision.</td></tr>
                            <tr><td class="p-3 font-medium">Presentation & Communication</td><td class="p-3">Presentation is clear, engaging, and skillfully connects all components.</td><td class="p-3">Presentation is clear and effectively explains the project.</td><td class="p-3">Presentation is disorganized or fails to articulate ideas.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <div id="modal-container"></div>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const PROJECT_DATA_KEY = 'futuresProjectData';
            
            // Global state
            let projectData = {};
            let milestones = [];
            let factorTooltip = null;

            const getDefaultState = () => ({
                problemStatement: "", rootCauses: "", affectedCommunities: "",
                visionSee: "", visionHear: "", visionFeel: "", visionExist: "",
                rankedValues: [],
                milestones: [],
                artifactType: null, artifactConcept: "",
                personaName: "", personaRole: "", personaGoals: "", personaConcerns: "",
                canvasMessage: "", canvasAudience: "", canvasImpact: "",
                presoHook: "", presoVision: "", presoDemo: "", presoPath: "",
            });

            // --- LOCAL STORAGE & STATE MANAGEMENT ---
            function saveState() {
                localStorage.setItem(PROJECT_DATA_KEY, JSON.stringify(projectData));
            }

            function loadState() {
                const savedData = localStorage.getItem(PROJECT_DATA_KEY);
                projectData = savedData ? JSON.parse(savedData) : getDefaultState();
                // Ensure milestones are loaded into the shared variable
                milestones = projectData.milestones || [];
            }

            function populateInputsFromState() {
                document.querySelectorAll('[data-save]').forEach(input => {
                    const key = input.dataset.save;
                    if (projectData[key] !== undefined) {
                        input.value = projectData[key];
                    }
                });
            }

            function clearState() {
                if (confirm("Are you sure you want to delete all your project data? This action cannot be undone.")) {
                    localStorage.removeItem(PROJECT_DATA_KEY);
                    window.location.reload();
                }
            }
            
            // --- INITIALIZATION ---
            function init() {
                loadState();
                
                setupNavigation();
                setupTabs();
                setupAccordions();
                setupPhase1Activities();
                setupPhase2Activities();
                setupPhase3Activities();
                renderCharts();
                
                populateInputsFromState();

                document.getElementById('reset-data-btn').addEventListener('click', clearState);

                // Create tooltips once
                if (!factorTooltip) {
                    factorTooltip = d3.select("body").append("div")
                        .attr("class", "d3-tooltip")
                        .style("opacity", 0);
                }
            }

            // --- SETUP FUNCTIONS ---
            function setupNavigation() {
                const navLinks = document.querySelectorAll('#main-nav a');
                const mobileNav = document.getElementById('mobile-nav');
                const contentSections = document.querySelectorAll('.content-section');

                function switchContent(targetId) {
                    contentSections.forEach(s => s.classList.remove('active'));
                    const activeSection = document.getElementById(targetId);
                    if (activeSection) activeSection.classList.add('active');
                    navLinks.forEach(l => l.classList.toggle('active', l.dataset.target === targetId));
                    if (mobileNav.value !== targetId) mobileNav.value = targetId;
                }

                navLinks.forEach(l => l.addEventListener('click', e => { e.preventDefault(); switchContent(l.dataset.target); }));
                mobileNav.addEventListener('change', e => switchContent(e.target.value));
            }
            
            function setupTabs() {
                const tabsContainer = document.getElementById('tabs-container');
                if (!tabsContainer) return;
                const tabButtons = tabsContainer.querySelectorAll('.tab-button');
                const tabContents = document.querySelectorAll('.tab-content');
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        tabContents.forEach(c => c.style.display = 'none');
                        document.getElementById(button.dataset.tab).style.display = 'block';
                    });
                });
            }

            function setupAccordions() {
                document.querySelectorAll('.accordion-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const content = header.nextElementSibling;
                        const icon = header.querySelector('.accordion-icon');
                        content.classList.toggle('hidden');
                        icon.textContent = content.classList.contains('hidden') ? '+' : '-';
                    });
                });
            }

            function setupPhase1Activities() {
                // Listen for changes on all inputs with data-save attribute
                document.querySelectorAll('[data-save]').forEach(input => {
                    input.addEventListener('input', (e) => {
                        projectData[e.target.dataset.save] = e.target.value;
                        saveState();
                    });
                });
                
                // Activity 1.2: Vision Synthesizer & Word Cloud
                document.getElementById('synthesize-vision-btn')?.addEventListener('click', () => {
                    const outputDiv = document.getElementById('synthesized-vision-output');
                    const allText = `${projectData.visionSee} ${projectData.visionHear} ${projectData.visionFeel} ${projectData.visionExist}`;

                    outputDiv.innerHTML = !allText.trim() 
                        ? `<p class="font-semibold">Please fill out at least one field.</p>`
                        : `<p class="font-semibold mb-2">My Future Vision:</p><p>In this future, you can see ${projectData.visionSee || '...'} and hear ${projectData.visionHear || '...'}. People feel ${projectData.visionFeel || '...'} because new systems like ${projectData.visionExist || '...'} are in place.</p>`;
                    outputDiv.classList.remove('hidden');

                    const wordCounts = allText.toLowerCase().match(/\b(\w+)\b/g)?.reduce((acc, word) => {
                        if (word.length > 3) acc[word] = (acc[word] || 0) + 1;
                        return acc;
                    }, {}) || {};
                    const wordList = Object.entries(wordCounts).map(([text, weight]) => [text, weight * 10]);
                    
                    if (wordList.length > 0) {
                        WordCloud(document.getElementById('vision-wordcloud'), { list: wordList, backgroundColor: '#FDFBF8', color: '#3C3C3B', weightFactor: 2 });
                    }
                });

                // Activity 1.3: Values Sorter
                const ALL_VALUES = ['Equity', 'Justice', 'Sustainability', 'Community', 'Empowerment', 'Accessibility', 'Inclusion', 'Transparency', 'Accountability', 'Resilience', 'Well-being', 'Dignity', 'Autonomy', 'Collaboration', 'Innovation', 'Feasibility', 'Scalability', 'Integrity', 'Participation'];
                const valuesPool = document.getElementById('values-pool');
                const rankedValuesContainer = document.getElementById('ranked-values');
                const valueSearch = document.getElementById('value-search');

                const renderRankedValues = () => {
                    if (!rankedValuesContainer) return;
                    rankedValuesContainer.innerHTML = '';
                    if (!projectData.rankedValues || projectData.rankedValues.length === 0) {
                        rankedValuesContainer.innerHTML = `<li class="text-center text-gray-400 p-4">Select values to rank them here.</li>`;
                    } else {
                        projectData.rankedValues.forEach(value => {
                            const rankedLi = document.createElement('li');
                            rankedLi.className = 'draggable bg-white p-2 rounded shadow-sm border flex justify-between items-center';
                            rankedLi.dataset.value = value;
                            rankedLi.draggable = true;
                            rankedLi.innerHTML = `<span>${value}</span><button class="remove-value-btn text-xl text-red-500 hover:text-red-700">&times;</button>`;
                            rankedValuesContainer.appendChild(rankedLi);
                            addDragEventsToItem(rankedLi);
                        });
                    }
                }
                
                const renderValuesPool = (filter = '') => {
                    if (!valuesPool) return;
                    valuesPool.innerHTML = '';
                    ALL_VALUES.forEach(value => {
                        const isSelected = projectData.rankedValues.includes(value);
                        if (value.toLowerCase().includes(filter.toLowerCase())) {
                            const li = document.createElement('li');
                            li.className = `value-item p-2 border rounded-md flex justify-between items-center ${isSelected ? 'disabled' : ''}`;
                            li.dataset.value = value;
                            li.innerHTML = `<span>${value}</span><button class="select-value-btn text-xl font-bold text-green-500 hover:text-green-700">+</button>`;
                            valuesPool.appendChild(li);
                        }
                    });
                };
            
                if (valuesPool) {
                    renderRankedValues();
                    renderValuesPool();

                    valueSearch.addEventListener('input', () => renderValuesPool(valueSearch.value));

                    valuesPool.addEventListener('click', e => {
                        if (e.target.classList.contains('select-value-btn')) {
                            const li = e.target.closest('.value-item');
                            const value = li.dataset.value;
                            projectData.rankedValues.push(value);
                            saveState();
                            renderRankedValues();
                            renderValuesPool(valueSearch.value);
                        }
                    });

                    rankedValuesContainer.addEventListener('click', e => {
                        if (e.target.classList.contains('remove-value-btn')) {
                            const value = e.target.closest('.draggable').dataset.value;
                            projectData.rankedValues = projectData.rankedValues.filter(v => v !== value);
                            saveState();
                            renderRankedValues();
                            renderValuesPool(valueSearch.value);
                        }
                    });

                    let draggedItem = null;
                    const addDragEventsToItem = item => {
                        item.addEventListener('dragstart', () => { draggedItem = item; setTimeout(() => item.style.display = 'none', 0); });
                        item.addEventListener('dragend', () => { 
                            setTimeout(() => { 
                                draggedItem.style.display = 'flex'; 
                                draggedItem = null; 
                                const newOrder = Array.from(rankedValuesContainer.querySelectorAll('.draggable')).map(li => li.dataset.value);
                                projectData.rankedValues = newOrder;
                                saveState();
                            }, 0);
                        });
                    };
                    
                    rankedValuesContainer.addEventListener('dragover', e => {
                        e.preventDefault();
                        const afterElement = getDragAfterElement(rankedValuesContainer, e.clientY);
                        if (afterElement == null) rankedValuesContainer.appendChild(draggedItem);
                        else rankedValuesContainer.insertBefore(draggedItem, afterElement);
                    });

                    function getDragAfterElement(container, y) {
                        const draggableElements = [...container.querySelectorAll('.draggable:not(.dragging)')];
                        return draggableElements.reduce((closest, child) => {
                            const box = child.getBoundingClientRect();
                            const offset = y - box.top - box.height / 2;
                            if (offset < 0 && offset > closest.offset) return { offset: offset, element: child };
                            else return closest;
                        }, { offset: Number.NEGATIVE_INFINITY }).element;
                    }
                }
            }
            
            function setupPhase2Activities() {
                const addMilestoneBtn = document.getElementById('add-milestone-btn');
                const milestoneList = document.getElementById('milestone-list');
                const criticalMilestoneSelect = document.getElementById('critical-milestone');
                
                const renderMilestones = () => {
                    milestoneList.innerHTML = '';
                    const currentSelection = criticalMilestoneSelect.value;
                    criticalMilestoneSelect.innerHTML = '<option value="-1">-- Select a milestone --</option>';
                    if (milestones.length === 0) {
                        milestoneList.innerHTML = `<p class="text-gray-500 italic">Your milestones will appear here...</p>`;
                        return;
                    }
                    milestones.sort((a, b) => b.year - a.year);
                    milestones.forEach(m => {
                        milestoneList.innerHTML += `<div class="timeline-item mb-4"><p class="font-bold text-[#C57B57]">${m.year}: <span class="font-normal text-gray-800">${m.desc}</span></p></div>`;
                        const option = document.createElement('option');
                        option.value = m.id;
                        option.textContent = `${m.year}: ${m.desc}`;
                        criticalMilestoneSelect.appendChild(option);
                    });
                    criticalMilestoneSelect.value = currentSelection;
                };

                addMilestoneBtn?.addEventListener('click', () => {
                    const yearInput = document.getElementById('milestone-year');
                    const descInput = document.getElementById('milestone-desc');
                    if (yearInput.value && descInput.value.trim()) {
                        milestones.push({ id: Date.now(), year: yearInput.value, desc: descInput.value.trim(), factors: [] });
                        projectData.milestones = milestones;
                        saveState();
                        yearInput.value = ''; descInput.value = '';
                        renderMilestones();
                    }
                });

                criticalMilestoneSelect?.addEventListener('change', (e) => {
                    const milestoneId = parseInt(e.target.value);
                    renderEnablerBarrierToolForMilestone(milestoneId);
                });
                
                renderMilestones();
            }

            function setupPhase3Activities() {
                const artifactRadios = document.getElementById('artifact-radios');
                if (!artifactRadios) return;

                const conceptContainer = document.getElementById('artifact-concept-container');
                const prompts = { video: "Outline your script or storyboard.", prototype: "Describe your prototype. What does it do?", website: "Sketch the main sections of your website or app.", policy: "What is the title of your policy brief? What are its key recommendations?" };
                
                artifactRadios.innerHTML = Object.keys(prompts).map(type => 
                    `<label class="flex items-center"><input type="radio" name="artifact-type" value="${type}" class="h-4 w-4" ${projectData.artifactType === type ? 'checked' : ''}> <span class="ml-2">${type.charAt(0).toUpperCase() + type.slice(1)}</span></label>`
                ).join('');

                const renderConceptInput = () => {
                    if (projectData.artifactType && prompts[projectData.artifactType]) {
                        conceptContainer.innerHTML = `<label for="artifact-concept" class="block text-sm font-medium text-gray-700 mt-4">Concept for ${projectData.artifactType}</label><textarea data-save="artifactConcept" id="artifact-concept" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" rows="4" placeholder="${prompts[projectData.artifactType]}"></textarea>`;
                        const conceptInput = conceptContainer.querySelector('[data-save]');
                        conceptInput.value = projectData.artifactConcept || '';
                        conceptInput.addEventListener('input', (e) => {
                            projectData[e.target.dataset.save] = e.target.value;
                            saveState();
                        });
                    } else {
                        conceptContainer.innerHTML = '';
                    }
                }

                artifactRadios.addEventListener('change', e => {
                    if(e.target.name === 'artifact-type') {
                        projectData.artifactType = e.target.value;
                        projectData.artifactConcept = '';
                        saveState();
                        renderConceptInput();
                    }
                });

                renderConceptInput();
            }
            
            // --- MILESTONE FACTOR ANALYSIS TOOL (Activity 2.2) ---
            function renderEnablerBarrierToolForMilestone(milestoneId) {
                const container = document.getElementById('enabler-barrier-tool-container');
                if (!container) return;
                if (milestoneId < 0) { container.innerHTML = ''; return; }
                
                container.innerHTML = `<div class="grid lg:grid-cols-5 gap-8 mt-4"><div class="lg:col-span-2 bg-white p-4 rounded-lg border"><h4 class="text-lg font-bold text-gray-800 mb-4">Factors for this Milestone</h4><div class="mb-4"><button id="add-factor-btn" class="w-full bg-[#C57B57] text-white font-bold p-2 rounded-md">Add Enabler/Barrier</button></div><div id="factor-list" class="space-y-2 h-96 overflow-y-auto p-2 bg-gray-50 rounded"></div></div><div class="lg:col-span-3 bg-white p-2 rounded-lg border relative"><h4 class="text-lg font-bold text-gray-800 mb-2 text-center">Prioritization Matrix</h4><div id="factor-plot-container" class="w-full h-[500px] relative"><svg id="factor-plot-svg" class="w-full h-full"></svg></div></div></div>`;

                document.getElementById("add-factor-btn").addEventListener("click", () => {
                    const currentMilestoneId = parseInt(document.getElementById('critical-milestone').value);
                    if(currentMilestoneId >= 0) openFactorModal(null, currentMilestoneId);
                });
                renderFactorList(milestoneId);
                requestAnimationFrame(() => renderFactorPlot(milestoneId));
            }

            function renderFactorList(milestoneId) {
                const list = document.getElementById("factor-list");
                if (!list) return;

                const milestone = milestones.find(m => m.id === milestoneId);
                if (!milestone) { list.innerHTML = ''; return; }

                const factors = milestone.factors;
                list.innerHTML = factors.length === 0 ? '<p class="text-gray-500 text-center p-4">No factors added yet.</p>' : factors.map(f => `<a href="#" class="block p-3 border-b border-gray-200 bg-white cursor-pointer hover:bg-stone-100" onclick="event.preventDefault(); openFactorModal(${f.id}, ${milestoneId})"><span class="font-semibold ${f.type === 'enabler' ? 'text-green-600' : 'text-red-600'}">${f.type.charAt(0).toUpperCase() + f.type.slice(1)}:</span> ${f.text}</a>`).join('');
            }

            function renderFactorPlot(milestoneId) {
                const container = d3.select("#factor-plot-container");
                if (container.empty()) return;

                const milestone = milestones.find(m => m.id === milestoneId);
                if (!milestone) { container.select("svg").selectAll("*").remove(); return; }
                const factors = milestone.factors.filter(f => f.impact !== null && f.effort !== null);
                
                const bounds = container.node().getBoundingClientRect();
                if (bounds.width === 0) { requestAnimationFrame(() => renderFactorPlot(milestoneId)); return; }

                const svg = container.select("svg");
                svg.selectAll("*").remove();
                const margin = {top: 40, right: 20, bottom: 60, left: 60};
                const width = bounds.width - margin.left - margin.right;
                const height = bounds.height - margin.top - margin.bottom;
                const x = d3.scaleLinear().domain([0, 100]).range([0, width]);
                const y = d3.scaleLinear().domain([0, 100]).range([height, 0]);
                const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);
                
                const quadrants = [{ x: x(50), y: 0, width: x(100)-x(50), height: y(50), color: 'rgba(239, 68, 68, 0.05)', label: 'Major Projects', textColor: '#9f1239' }, { x: 0, y: 0, width: x(50), height: y(50), color: 'rgba(108, 117, 125, 0.05)', label: 'Thankless Tasks', textColor: '#475569' }, { x: 0, y: y(50), width: x(50), height: y(0)-y(50), color: 'rgba(245, 158, 11, 0.05)', label: 'Fill-ins', textColor: '#854d0e' }, { x: x(50), y: y(50), width: x(100)-x(50), height: y(0)-y(50), color: 'rgba(34, 197, 94, 0.05)', label: 'Quick Wins', textColor: '#166534' }];
                g.selectAll('.quadrant-bg').data(quadrants).enter().append('rect').attr('x', d => d.x).attr('y', d => d.y).attr('width', d => d.width).attr('height', d => d.height).attr('fill', d => d.color);
                g.selectAll('.quadrant-label').data(quadrants).enter().append('text').attr('x', d => d.x + 10).attr('y', d => d.y + 20).text(d => d.label).attr('fill', d=> d.textColor).style('font-weight', '600').style('font-size', '12px');

                g.append("g").attr("transform", `translate(0, ${height})`).call(d3.axisBottom(x).ticks(5));
                g.append("g").call(d3.axisLeft(y).ticks(5));
                svg.append("text").attr("text-anchor", "middle").attr("x", margin.left + width / 2).attr("y", height + margin.top + 40).text("Impact (Low to High)");
                svg.append("text").attr("text-anchor", "middle").attr("transform", "rotate(-90)").attr("y", 15).attr("x", -(margin.top + height / 2)).text("Effort (Low to High)");
                
                const drag = d3.drag()
                    .on("start", function() { d3.select(this).raise().style('cursor', 'grabbing'); })
                    .on("drag", function(event, d) {
                        d.impact = Math.max(0, Math.min(100, x.invert(event.x)));
                        d.effort = Math.max(0, Math.min(100, y.invert(event.y)));
                        d3.select(this).attr("transform", `translate(${x(d.impact)}, ${y(d.effort)})`);
                    })
                    .on("end", function() { d3.select(this).style('cursor', 'grab'); renderFactorList(milestoneId); saveState(); });

                g.selectAll(".factor-node").data(factors, d => d.id).enter().append("g")
                    .attr("class", "factor-node").attr("transform", d => `translate(${x(d.impact)}, ${y(d.effort)})`)
                    .style('cursor', 'grab').call(drag)
                    .append("circle").attr("r", 8).attr("fill", d => d.type === 'enabler' ? 'rgba(34, 197, 94, 0.7)' : 'rgba(239, 68, 68, 0.7)').attr("stroke", d => d.type === 'enabler' ? '#15803d' : '#b91c1c').attr("stroke-width", 1.5)
                    .on("mouseover", (event, d) => {
                        factorTooltip.transition().duration(200).style("opacity", .9);
                        factorTooltip.html(`<strong>${d.type.charAt(0).toUpperCase() + d.type.slice(1)}:</strong> ${d.text}`).style("left", (event.pageX + 15) + "px").style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", () => factorTooltip.transition().duration(500).style("opacity", 0))
                    .on("click", (event, d) => { if (!event.defaultPrevented) openFactorModal(d.id, milestoneId); });
            }

            function openFactorModal(factorId, milestoneId) {
                const isNew = factorId === null;
                const milestone = milestones.find(m => m.id === milestoneId);
                if (!milestone) return;

                const factor = isNew ? { id: null, text: "", impact: 50, effort: 50, type: 'barrier' } : milestone.factors.find(f => f.id === factorId);
                if (!factor) return;
                
                const createSliderRow = (criterion, label, value) => `<div><label class="block font-semibold">${label} <span class="font-normal text-gray-500" id="${criterion}-value">${value}</span></label><input type="range" min="1" max="100" value="${value}" name="${criterion}" class="w-full mt-1 accent-[#C57B57]" oninput="document.getElementById('${criterion}-value').textContent = this.value"></div>`;
                
                const modalHTML = `<div id="factor-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center p-4 z-50"><div class="bg-white rounded-lg shadow-xl w-full max-w-lg"><div class="p-6 border-b"><h2 class="text-2xl font-bold text-[#C57B57]">${isNew ? 'Add New' : 'Edit'} Factor</h2></div><div class="p-6 space-y-4"><input type="hidden" id="current-factor-id" value="${factorId || ''}"><input type="hidden" id="current-milestone-id" value="${milestoneId}"><div><label class="block font-semibold">Factor Type</label><div class="flex gap-4 mt-1"><label><input type="radio" name="factor-type" value="barrier" ${factor.type === 'barrier' ? 'checked' : ''}> Barrier</label><label><input type="radio" name="factor-type" value="enabler" ${factor.type === 'enabler' ? 'checked' : ''}> Enabler</label></div></div><div><label class="block font-semibold">Description</label><textarea id="factor-text-input" rows="2" class="w-full p-2 border rounded-md">${factor.text}</textarea></div>${createSliderRow('impact', 'Impact (Low to High)', factor.impact)}${createSliderRow('effort', 'Effort (Low to High)', factor.effort)}</div><div class="p-4 bg-gray-50 border-t flex justify-end space-x-2"><button onclick="document.getElementById('factor-modal').remove()" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg">Cancel</button>${!isNew ? `<button onclick="deleteFactor(${factorId}, ${milestoneId})" class="bg-red-200 text-red-800 font-bold py-2 px-4 rounded-lg">Delete</button>` : ''}<button onclick="saveFactorDetails()" class="bg-[#C57B57] text-white font-bold py-2 px-4 rounded-lg">Save</button></div></div></div>`;
                document.getElementById('modal-container').innerHTML = modalHTML;
            }

            window.openFactorModal = openFactorModal;
            window.saveFactorDetails = () => {
                const factorId = document.getElementById('current-factor-id').value;
                const milestoneId = parseInt(document.getElementById('current-milestone-id').value);
                const isNew = factorId === '';
                const milestone = milestones.find(m => m.id === milestoneId);
                if (!milestone) return;

                let factor = isNew ? { id: Date.now() } : milestone.factors.find(f => f.id == factorId);
                factor.text = document.getElementById('factor-text-input').value;
                if (!factor.text.trim()) { alert("Please enter a description."); return; }
                factor.type = document.querySelector('input[name="factor-type"]:checked').value;
                factor.impact = parseInt(document.querySelector('input[name="impact"]').value);
                factor.effort = parseInt(document.querySelector('input[name="effort"]').value);

                if (isNew) milestone.factors.push(factor);
                saveState();
                
                document.getElementById('factor-modal').remove();
                renderFactorList(milestoneId);
                renderFactorPlot(milestoneId);
            };
            window.deleteFactor = (factorId, milestoneId) => {
                const milestone = milestones.find(m => m.id === milestoneId);
                if (milestone) milestone.factors = milestone.factors.filter(f => f.id !== factorId);
                saveState();
                document.getElementById('factor-modal').remove();
                renderFactorList(milestoneId);
                renderFactorPlot(milestoneId);
            };

            // --- RENDER CHARTS ---
            function renderCharts() {
                const defaultOptions = { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, font: { family: "'Inter', sans-serif" } };
                const spiralCtx = document.getElementById('duboisSpiralChart')?.getContext('2d');
                if (spiralCtx) new Chart(spiralCtx, { type: 'doughnut', data: { labels: ["1874", "1880", "1885", "1890", "1895", "1900"], datasets: [{ label: 'Value ($)', data: [6141381, 7149021, 8956241, 11453861, 13019343, 14118721], backgroundColor: ['#008080', '#D2B48C', '#FFC0CB', '#F4A460', '#2E8B57', '#800000'], borderWidth: 0 }] }, options: { ...defaultOptions, plugins: { ...defaultOptions.plugins, title: { display: true, text: "Value of Property Owned by Black Georgians", font: {size: 16, family: "'Lora', serif"}}}, cutout: '30%' } });
                
                const barCtx = document.getElementById('duboisBarChart')?.getContext('2d');
                if(barCtx) new Chart(barCtx, { type: 'bar', data: { labels: ['Agriculture/Fishing', 'Domestic/Personal Service', 'Manufacturing', 'Trade/Transportation', 'Professions'], datasets: [{ label: 'Black Population', data: [62.2, 28.5, 4.3, 3.8, 1.2], backgroundColor: '#3C3C3B' }, { label: 'White Population', data: [40.4, 9.6, 17.1, 25.1, 7.8], backgroundColor: '#C57B57' }] }, options: { ...defaultOptions, indexAxis: 'y', scales: { x: { ticks: { callback: v => v + '%' } } }, plugins: { ...defaultOptions.plugins, title: { display: true, text: "Occupational Distribution in Georgia (%)", font: {size: 16, family: "'Lora', serif"} } } } });
            }

            // --- RUN APP ---
            init();
        });
    </script>
</body>
</html>

